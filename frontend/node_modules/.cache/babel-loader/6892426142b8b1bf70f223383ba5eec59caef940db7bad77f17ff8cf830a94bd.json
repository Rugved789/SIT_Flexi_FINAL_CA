{"ast":null,"code":"import _objectSpread from\"E:/SEM5/Mini_Project/donation-management-system/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useContext}from\"react\";import api from\"../../utils/api\";import{AuthContext}from\"../../context/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Profile=()=>{const{user:authUser,loginUser}=useContext(AuthContext);const[form,setForm]=useState({name:\"\",email:\"\",contact:\"\",address:\"\",password:\"\"});const[loading,setLoading]=useState(false);const[errors,setErrors]=useState([]);const[success,setSuccess]=useState(\"\");useEffect(()=>{const fetchProfile=async()=>{setLoading(true);try{const res=await api.get(\"/auth/profile\");const u=res.data.user;setForm({name:u.name||\"\",email:u.email||\"\",contact:u.contact||\"\",address:u.address||\"\",password:\"\"});}catch(err){var _err$response,_err$response$data;console.error(\"Failed fetching profile\",err);setErrors([{msg:((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Failed to load profile\"}]);}finally{setLoading(false);}};fetchProfile();},[]);const handleChange=e=>{setForm(_objectSpread(_objectSpread({},form),{},{[e.target.name]:e.target.value}));};const handleSubmit=async e=>{e.preventDefault();setErrors([]);setSuccess(\"\");setLoading(true);try{const payload={name:form.name,email:form.email,contact:form.contact,address:form.address};if(form.password)payload.password=form.password;const res=await api.put(\"/auth/profile\",payload);const updated=res.data.user;setSuccess(res.data.message||\"Profile updated\");// Update global auth context and localStorage user copy\nif(loginUser){// keep token as-is, update stored user\nconst token=localStorage.getItem(\"token\");loginUser(updated,token);}}catch(err){var _err$response2;console.error(\"Update profile error\",err);const resp=(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data;if(resp!==null&&resp!==void 0&&resp.errors&&Array.isArray(resp.errors)){setErrors(resp.errors.map(r=>({msg:r.msg||r.message||JSON.stringify(r)})));}else if(resp!==null&&resp!==void 0&&resp.message){setErrors([{msg:resp.message}]);}else{setErrors([{msg:\"Failed to update profile\"}]);}}finally{setLoading(false);setForm(prev=>_objectSpread(_objectSpread({},prev),{},{password:\"\"}));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"profile-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"My Profile\"}),loading&&/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}),errors.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"form-errors\",children:errors.map((err,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"error-item\",children:err.msg},idx))}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"form-success\",children:success}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"profile-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"input\",{name:\"name\",value:form.name,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{name:\"email\",value:form.email,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Contact\"}),/*#__PURE__*/_jsx(\"input\",{name:\"contact\",value:form.contact,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Address\"}),/*#__PURE__*/_jsx(\"input\",{name:\"address\",value:form.address,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"New Password (leave blank to keep)\"}),/*#__PURE__*/_jsx(\"input\",{name:\"password\",type:\"password\",value:form.password,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,children:\"Save profile\"})]})]});};export default Profile;","map":{"version":3,"names":["React","useEffect","useState","useContext","api","AuthContext","jsx","_jsx","jsxs","_jsxs","Profile","user","authUser","loginUser","form","setForm","name","email","contact","address","password","loading","setLoading","errors","setErrors","success","setSuccess","fetchProfile","res","get","u","data","err","_err$response","_err$response$data","console","error","msg","response","message","handleChange","e","_objectSpread","target","value","handleSubmit","preventDefault","payload","put","updated","token","localStorage","getItem","_err$response2","resp","Array","isArray","map","r","JSON","stringify","prev","className","children","length","idx","onSubmit","onChange","type","disabled"],"sources":["E:/SEM5/Mini_Project/donation-management-system/frontend/src/pages/donor/Profile.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport api from \"../../utils/api\";\r\nimport { AuthContext } from \"../../context/AuthContext\";\r\n\r\nconst Profile = () => {\r\n  const { user: authUser, loginUser } = useContext(AuthContext);\r\n  const [form, setForm] = useState({ name: \"\", email: \"\", contact: \"\", address: \"\", password: \"\" });\r\n  const [loading, setLoading] = useState(false);\r\n  const [errors, setErrors] = useState([]);\r\n  const [success, setSuccess] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const fetchProfile = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const res = await api.get(\"/auth/profile\");\r\n        const u = res.data.user;\r\n        setForm({ name: u.name || \"\", email: u.email || \"\", contact: u.contact || \"\", address: u.address || \"\", password: \"\" });\r\n      } catch (err) {\r\n        console.error(\"Failed fetching profile\", err);\r\n        setErrors([{ msg: err.response?.data?.message || \"Failed to load profile\" }]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    setForm({ ...form, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setErrors([]);\r\n    setSuccess(\"\");\r\n    setLoading(true);\r\n    try {\r\n      const payload = { name: form.name, email: form.email, contact: form.contact, address: form.address };\r\n      if (form.password) payload.password = form.password;\r\n\r\n      const res = await api.put(\"/auth/profile\", payload);\r\n      const updated = res.data.user;\r\n      setSuccess(res.data.message || \"Profile updated\");\r\n\r\n      // Update global auth context and localStorage user copy\r\n      if (loginUser) {\r\n        // keep token as-is, update stored user\r\n        const token = localStorage.getItem(\"token\");\r\n        loginUser(updated, token);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Update profile error\", err);\r\n      const resp = err.response?.data;\r\n      if (resp?.errors && Array.isArray(resp.errors)) {\r\n        setErrors(resp.errors.map((r) => ({ msg: r.msg || r.message || JSON.stringify(r) })));\r\n      } else if (resp?.message) {\r\n        setErrors([{ msg: resp.message }]);\r\n      } else {\r\n        setErrors([{ msg: \"Failed to update profile\" }]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n      setForm((prev) => ({ ...prev, password: \"\" }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <h1>My Profile</h1>\r\n\r\n      {loading && <p>Loading...</p>}\r\n\r\n      {errors.length > 0 && (\r\n        <div className=\"form-errors\">\r\n          {errors.map((err, idx) => (\r\n            <div key={idx} className=\"error-item\">{err.msg}</div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {success && <div className=\"form-success\">{success}</div>}\r\n\r\n      <form onSubmit={handleSubmit} className=\"profile-form\">\r\n        <div className=\"form-group\">\r\n          <label>Name</label>\r\n          <input name=\"name\" value={form.name} onChange={handleChange} />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Email</label>\r\n          <input name=\"email\" value={form.email} onChange={handleChange} />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Contact</label>\r\n          <input name=\"contact\" value={form.contact} onChange={handleChange} />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Address</label>\r\n          <input name=\"address\" value={form.address} onChange={handleChange} />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>New Password (leave blank to keep)</label>\r\n          <input name=\"password\" type=\"password\" value={form.password} onChange={handleChange} />\r\n        </div>\r\n\r\n        <button type=\"submit\" disabled={loading}>Save profile</button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Profile;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}